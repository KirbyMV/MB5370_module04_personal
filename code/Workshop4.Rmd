---
title: "Workshop 4"
output: html_document
date: "2025-09-19"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


R can be used as a GIS. Useful because of version controls, can save a script, can interface with other R uses like ggplot, and it is free.

# Installing the spatial R packages

```{r}
# install.packages("sf") 
# install.packages("terra")
# install.packages("tmap")


#load into R library
library(tidyverse)
library(sf) # simple features
library (terra) # for raster
library(tmap) # Thematic maps are geographical maps in which spatial data distributions are visualized
```

# Downloading and loading the spatial dataset

```{r}
#load the copepod data into R studio
library(readr)
dat <- read_csv("../data/data-for-course/copepods_raw.csv")
dat
```

# Data exploration

# Check coordinates

```{r}
library(ggplot2)
ggplot(dat) + 
  aes(x = longitude, y = latitude, color = richness_raw) +
  geom_point()
```
Look at species richness in a non-spatial way
```{r}
ggplot(dat, aes(x = latitude, y = richness_raw)) + 
  stat_smooth() + 
  geom_point()
```

# Getting going with maps

First we turn point data into a spatially referenced dataframe (like a GIS shapefile)

sf stands for simple features
```{r}
sdat <- st_as_sf(dat, coords = c("longitude", "latitude"), 
                 crs = 4326)
```
st_as_sf converts data types to simple features.
coords gives the columns that contain our coordinates
crs stands for coordinate reference system

# Coordinate reference systems

Required for 2D mapping to the 3D earth

EPSG code is a short-hand for a specific coordinate reference system

In R its best practice to use an EPSG code or a WKT (well-known text) to define a crs

```{r}
crs4326 <- st_crs(4326)
crs4326 # look at the whole CRS
crs4326$Name # pull out just the name of the crs
```
```{r}
crs4326$wkt # crs in well-known text format
```

Now we need to decide how to project 3 dimensions into 2.
Projections are defined by a projected coordinate reference system (PCS), and spatial packages in R use the software PROJ to do this.

# Feature collection (points)

```{r}
sdat
```
Now it has a geometry column with the coordinates.

So in summary, a simple feature is like a shapefile, in that it holds a lot of data in columns and rows but is spatially aware. Essentially, that includes extra columns regarding each row's position (in coordinates) and metadata about the coordinate reference system, the type of geometry (Point) and so on.

# Cartography

```{r}
plot(sdat["richness_raw"])
```
use [] to select a single variable so it doesn't graph the entire dataframe, like this:
```{r}
plot(sdat)
```

# Thematic maps for communication

tmap works similarly to ggplot: we build and add on layers

```{r}
#using tmap

tm1 <- tm_shape(sdat) + 
  tm_dots(col = "richness_raw", palette = "tableau.classic_orange" )
```
tm_dots to plot dots of the coordinates. Other options are tm_polygons, tm_symbols and many others we’ll see later.
We’ve chosen "richness_raw" as the color scale

```{r}
tmap_save(tm1, filename = "../output/Richness-map.png", 
          width = 600, height = 600)
```

# Mapping spatial polygons as layers

#Loading shapefiles

.shp files are usually undesirable bc they are inefficient

.gpkg is better, but we'll stick with .shp for this workshop

```{r}
aus <- st_read("../data/data-for-course/spatial-data/Aussie/Aussie.shp")
```

```{r}
shelf <- st_read("../data/data-for-course/spatial-data/aus_shelf/aus_shelf.shp")
```

# Mapping your polygons

```{r}
tm_shape(shelf) + 
  tm_polygons()
```

```{r}
tm_shape(shelf, bbox = sdat) + 
  tm_polygons() +
  tm_shape(aus) + 
  tm_polygons() + 
  tm_shape(sdat) + 
  tm_dots()
```


